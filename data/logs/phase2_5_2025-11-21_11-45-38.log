2025-11-21 11:45:38,439 [INFO] [sae_analyzer] setup_logging:167 - Phase: 2.5, GPU: CPU
2025-11-21 11:45:38,440 [INFO] [phase4_8.steering_effect_analyzer] setup_logging:167 - Phase: 4.8, GPU: CPU
2025-11-21 11:45:38,440 [INFO] [main] run_phase4_8:954 - Starting Phase 4.8: Steering Effect Analysis
2025-11-21 11:45:38,440 [INFO] [main] run_phase4_8:955 - Experiment mode: all
2025-11-21 11:45:38,440 [INFO] [main] run_phase4_8:956 - Will auto-discover PVA features from Phase 2.5 and baseline from Phase 3.5
2025-11-21 11:45:38,441 [INFO] [main] run_phase4_8:959 - 
============================================================
CONFIGURATION
============================================================

ACTIVATION Settings:
  activation_cleanup_after_batch: True
  activation_clear_cache_between_layers: True
  activation_hook_type: resid_post
  activation_layers: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25]
  activation_max_cache_gb: 10.0
  activation_max_length: 2048
  activation_position: -1

AUTOSAVE Settings:
  autosave_frequency: 100
  autosave_keep_last: 3

CHECKPOINT Settings:
  checkpoint_dir: checkpoints
  checkpoint_frequency: 50

CONTINUE Settings:
  continue_on_error: True

DATASET Settings:
  dataset_dir: data/phase1_0
  dataset_end_idx: 10
  dataset_name: humaneval
  dataset_split: test
  dataset_start_idx: 0

ENABLE Settings:
  enable_timing_stats: True

EVALUATION Settings:
  evaluation_random_seed: 42

GC Settings:
  gc_collect_frequency: 50

LOG Settings:
  log_dir: data/logs

MAX Settings:
  max_gpu_memory_usage_gb: 30.0
  max_memory_usage_gb: 100.0
  max_retries: 3

MEMORY Settings:
  memory_cleanup_frequency: 100

MODEL Settings:
  model_device: None
  model_dtype: None
  model_max_new_tokens: 800
  model_name: google/gemma-2-2b
  model_temperature: 0.0
  model_trust_remote_code: True

ORTHOGONALIZATION Settings:
  orthogonalization_target_weights: [embed, attn_o, mlp_down]

PHASE0 Settings:
  phase0_1_output_dir: data/phase0_1
  phase0_2_output_dir: data/phase0_2_humaneval
  phase0_3_output_dir: data/phase0_3_humaneval
  phase0_output_dir: data/phase0

PHASE1 Settings:
  phase1_output_dir: data/phase1_0

PHASE2 Settings:
  phase2_10_output_dir: data/phase2_10
  phase2_15_output_dir: data/phase2_15
  phase2_2_output_dir: data/phase2_2
  phase2_5_output_dir: data/phase2_5
  phase2_output_dir: data/phase2

PHASE3 Settings:
  phase3_10_output_dir: data/phase3_10
  phase3_10_temperatures: [0.0, 0.2, 0.4, 0.6, 0.8, 1.0, 1.2, 1.4]
  phase3_11_output_dir: data/phase3_11
  phase3_12_output_dir: data/phase3_12
  phase3_5_output_dir: data/phase3_5
  phase3_6_output_dir: data/phase3_6
  phase3_8_output_dir: data/phase3_8
  phase3_output_dir: data/phase3

PHASE4 Settings:
  **phase4_8_correct_coefficient**: 29
  **phase4_8_experiment_mode**: all
  **phase4_8_incorrect_coefficient**: 287
  **phase4_8_output_dir**: data/phase4_8
  phase4_10_min_activation_freq: 0.001
  phase4_10_n_features: 10
  phase4_10_output_dir: data/phase4_10
  phase4_10_separation_threshold: 0.01
  phase4_12_output_dir: data/phase4_12
  phase4_14_output_dir: data/phase4_14
  phase4_14_significance_level: 0.05
  phase4_5_correct_coefficients: [10.0, 20.0, 30.0, 40.0, 50.0, 60.0, 70.0, 80.0, 90.0, 100.0]
  phase4_5_experiment_mode: all
  phase4_5_incorrect_coefficients: [100.0, 200.0, 300.0, 400.0, 500.0, 600.0, 700.0, 800.0, 900.0, 1000.0]
  phase4_5_meaningful_effect_threshold: 5.0
  phase4_5_output_dir: data/phase4_5
  phase4_5_plateau_threshold: 2.0
  phase4_5_search_tolerance: 2.0
  phase4_6_experiment_mode: all
  phase4_6_output_dir: data/phase4_6
  phase4_6_tolerance: 1.0

PHASE5 Settings:
  phase5_3_output_dir: data/phase5_3
  phase5_6_output_dir: data/phase5_6
  phase5_9_output_dir: data/phase5_9
  phase5_9_significance_level: 0.05

PHASE6 Settings:
  phase6_3_output_dir: data/phase6_3

PHASE7 Settings:
  phase7_12_output_dir: data/phase7_12
  phase7_3_model_name: google/gemma-2-2b-it
  phase7_3_output_dir: data/phase7_3
  phase7_6_model_name: google/gemma-2-2b-it
  phase7_6_output_dir: data/phase7_6

PHASE8 Settings:
  phase8_1_output_dir: data/phase8_1
  phase8_2_output_dir: data/phase8_2
  phase8_3_output_dir: data/phase8_3
  phase8_3_percentile: 70.0
  phase8_3_use_percentile_threshold: True

PILE Settings:
  pile_filter_enabled: True
  pile_samples: 10000
  pile_threshold: 0.02

PROGRESS Settings:
  progress_log_frequency: 10

RETRY Settings:
  retry_backoff: 1.0

SAE Settings:
  sae_checkpoint_dir: data/phase2/sae_checkpoints
  sae_cleanup_after_layer: True
  sae_hook_component: resid_post
  sae_latent_threshold: 0.02
  sae_repo_id: google/gemma-scope-2b-pt-res
  sae_save_after_each_layer: True
  sae_sparsity: 71
  sae_use_memory_mapping: False
  sae_width: 16k

SHOW Settings:
  show_progress_bar: True

SPLIT Settings:
  split_n_strata: 10
  split_random_seed: 42
  split_ratio_tolerance: 0.02

T Settings:
  t_statistic_min_samples: 10

TEMPERATURE Settings:
  temperature_samples_per_temp: 3
  temperature_variation_temps: [0.0]

TIMEOUT Settings:
  timeout_per_record: 300.0

VERBOSE Settings:
  verbose: False

============================================================
2025-11-21 11:45:38,442 [INFO] [phase4_8.steering_effect_analyzer] __init__:65 - Output directory: data/phase4_8_humaneval
2025-11-21 11:45:38,442 [INFO] [phase4_8.steering_effect_analyzer] __init__:71 - Loading model: google/gemma-2-2b
2025-11-21 11:45:38,631 [INFO] [common_simplified.model_loader] load_model_and_tokenizer:47 - Loading model google/gemma-2-2b on cuda with dtype torch.bfloat16
2025-11-21 11:45:40,068 [INFO] [common_simplified.model_loader] load_model_and_tokenizer:56 - Loading model to cuda...
2025-11-21 11:45:44,946 [INFO] [common_simplified.model_loader] load_model_and_tokenizer:86 - Model successfully loaded on cuda:0
2025-11-21 11:45:44,946 [INFO] [common_simplified.model_loader] load_model_and_tokenizer:88 - Model loaded successfully: Gemma2ForCausalLM
2025-11-21 11:45:44,947 [INFO] [common_simplified.model_loader] load_model_and_tokenizer:89 - Model size: 2.61B parameters
2025-11-21 11:45:44,949 [INFO] [phase4_8.steering_effect_analyzer] _load_dependencies:99 - Loading PVA features from Phase 2.5...
2025-11-21 11:45:44,949 [INFO] [phase4_8.steering_effect_analyzer] _load_dependencies:104 - Using Phase 2.5 output: data/phase2_5/sae_analysis_results.json
2025-11-21 11:45:44,950 [INFO] [phase4_8.steering_effect_analyzer] _load_dependencies:124 - Best correct feature: Layer 16, Index 11225, Score 0.2212
2025-11-21 11:45:44,950 [INFO] [phase4_8.steering_effect_analyzer] _load_dependencies:127 - Best incorrect feature: Layer 25, Index 2853, Score 0.2010
2025-11-21 11:45:44,950 [INFO] [phase4_8.steering_effect_analyzer] _load_dependencies:132 - Loading baseline data from Phase 3.5...
2025-11-21 11:45:44,951 [INFO] [phase4_8.steering_effect_analyzer] _load_dependencies:137 - Using Phase 3.5 output: data/phase3_5_humaneval
2025-11-21 11:45:44,977 [INFO] [phase4_8.steering_effect_analyzer] _load_dependencies:145 - Loaded 164 problems from Phase 3.5 baseline
2025-11-21 11:45:44,977 [INFO] [phase4_8.steering_effect_analyzer] _load_dependencies:161 - Processing validation dataset rows 0-10 (inclusive)
2025-11-21 11:45:44,978 [INFO] [phase4_8.steering_effect_analyzer] _load_dependencies:163 - Filtered to 11 problems
2025-11-21 11:45:44,978 [INFO] [phase4_8.steering_effect_analyzer] _load_dependencies:166 - Loading SAE models...
2025-11-21 11:45:44,978 [INFO] [sae_analyzer] load_gemma_scope_sae:47 - Loading GemmaScope SAE for layer 16
2025-11-21 11:45:44,978 [INFO] [sae_analyzer] load_gemma_scope_sae:61 - Loading from HuggingFace: google/gemma-scope-2b-pt-res/layer_16/width_16k/average_l0_78/params.npz
2025-11-21 11:45:44,978 [INFO] [sae_analyzer] load_gemma_scope_sae:62 - This may take a while if the model is not cached...
2025-11-21 11:45:45,193 [INFO] [sae_analyzer] load_gemma_scope_sae:70 - Download complete, loading from: /home/kriz_tahimic/.cache/huggingface/hub/models--google--gemma-scope-2b-pt-res/snapshots/fd571b47c1c64851e9b1989792367b9babb4af63/layer_16/width_16k/average_l0_78/params.npz
2025-11-21 11:45:46,142 [INFO] [sae_analyzer] load_gemma_scope_sae:87 - Loaded SAE with d_model=2304, d_sae=16384, sparsity=78
2025-11-21 11:45:46,142 [INFO] [sae_analyzer] load_gemma_scope_sae:47 - Loading GemmaScope SAE for layer 25
2025-11-21 11:45:46,142 [INFO] [sae_analyzer] load_gemma_scope_sae:61 - Loading from HuggingFace: google/gemma-scope-2b-pt-res/layer_25/width_16k/average_l0_116/params.npz
2025-11-21 11:45:46,142 [INFO] [sae_analyzer] load_gemma_scope_sae:62 - This may take a while if the model is not cached...
2025-11-21 11:45:48,994 [INFO] [sae_analyzer] load_gemma_scope_sae:70 - Download complete, loading from: /home/kriz_tahimic/.cache/huggingface/hub/models--google--gemma-scope-2b-pt-res/snapshots/fd571b47c1c64851e9b1989792367b9babb4af63/layer_25/width_16k/average_l0_116/params.npz
2025-11-21 11:45:49,930 [INFO] [sae_analyzer] load_gemma_scope_sae:87 - Loaded SAE with d_model=2304, d_sae=16384, sparsity=116
2025-11-21 11:45:49,947 [INFO] [phase4_8.steering_effect_analyzer] _load_dependencies:189 - Decoder directions converted to model dtype: torch.bfloat16
2025-11-21 11:45:49,947 [INFO] [phase4_8.steering_effect_analyzer] _load_dependencies:190 - Dependencies loaded successfully
2025-11-21 11:45:49,949 [INFO] [phase4_8.steering_effect_analyzer] _split_baseline_by_correctness:281 - Split baseline: 2 initially correct, 9 initially incorrect problems
2025-11-21 11:45:49,949 [INFO] [phase4_8.steering_effect_analyzer] __init__:94 - SteeringEffectAnalyzer initialized successfully
2025-11-21 11:45:49,949 [INFO] [phase4_8.steering_effect_analyzer] run:999 - Starting Phase 4.8: Steering Effect Analysis
2025-11-21 11:45:49,949 [INFO] [phase4_8.steering_effect_analyzer] run:1000 - Coefficients - Correct: 29, Incorrect: 287
2025-11-21 11:45:49,949 [INFO] [phase4_8.steering_effect_analyzer] evaluate_steering_effects:560 - Evaluating steering effects...
2025-11-21 11:45:49,950 [INFO] [phase4_8.steering_effect_analyzer] evaluate_steering_effects:567 - Running experiments in 'all' mode
2025-11-21 11:45:49,950 [INFO] [phase4_8.steering_effect_analyzer] evaluate_steering_effects:572 - Running correction experiment (correct steering on incorrect data)...
2025-11-21 11:45:49,950 [INFO] [phase4_8.steering_effect_analyzer] _apply_steering:347 - Applying correct steering with coefficient 29 to 9 problems
2025-11-21 11:45:49,950 [INFO] [common_simplified.activation_hooks] __init__:185 - Initialized AttentionExtractor for layers [16] at position -1
2025-11-21 11:45:49,950 [INFO] [phase4_8.steering_effect_analyzer] _apply_steering:370 - Created AttentionExtractor for correct steering on layer 16
2025-11-21 11:45:49,952 [INFO] [common_simplified.activation_hooks] setup_hooks:204 - Set up attention hooks for 1 layers
2025-11-21 11:45:59,428 [INFO] [common_simplified.activation_hooks] setup_hooks:204 - Set up attention hooks for 1 layers
2025-11-21 11:46:41,831 [INFO] [common_simplified.activation_hooks] setup_hooks:204 - Set up attention hooks for 1 layers
2025-11-21 11:46:50,787 [INFO] [common_simplified.activation_hooks] setup_hooks:204 - Set up attention hooks for 1 layers
2025-11-21 11:47:00,874 [INFO] [common_simplified.activation_hooks] setup_hooks:204 - Set up attention hooks for 1 layers
2025-11-21 11:47:07,954 [INFO] [common_simplified.activation_hooks] setup_hooks:204 - Set up attention hooks for 1 layers
2025-11-21 11:47:25,087 [INFO] [common_simplified.activation_hooks] setup_hooks:204 - Set up attention hooks for 1 layers
2025-11-21 11:47:33,317 [INFO] [common_simplified.activation_hooks] setup_hooks:204 - Set up attention hooks for 1 layers
2025-11-21 11:48:15,253 [INFO] [common_simplified.activation_hooks] setup_hooks:204 - Set up attention hooks for 1 layers
2025-11-21 11:48:56,900 [INFO] [phase4_8.steering_effect_analyzer] _apply_steering:526 - Completed correct steering: 1 flipped out of 9 successful (9 attempted, 0 excluded)
2025-11-21 11:48:56,925 [INFO] [phase4_8.steering_effect_analyzer] evaluate_steering_effects:586 - Saved 9 correction steering results to all_correction_results.json
2025-11-21 11:48:56,925 [INFO] [phase4_8.steering_effect_analyzer] evaluate_steering_effects:594 - Running corruption experiment (incorrect steering on correct data)...
2025-11-21 11:48:56,925 [INFO] [phase4_8.steering_effect_analyzer] _apply_steering:347 - Applying incorrect steering with coefficient 287 to 2 problems
2025-11-21 11:48:56,925 [INFO] [common_simplified.activation_hooks] __init__:185 - Initialized AttentionExtractor for layers [25] at position -1
2025-11-21 11:48:56,925 [INFO] [phase4_8.steering_effect_analyzer] _apply_steering:370 - Created AttentionExtractor for incorrect steering on layer 25
2025-11-21 11:48:56,926 [INFO] [common_simplified.activation_hooks] setup_hooks:204 - Set up attention hooks for 1 layers
2025-11-21 11:49:38,626 [INFO] [common_simplified.activation_hooks] setup_hooks:204 - Set up attention hooks for 1 layers
2025-11-21 11:50:20,560 [INFO] [phase4_8.steering_effect_analyzer] _apply_steering:526 - Completed incorrect steering: 2 flipped out of 2 successful (2 attempted, 0 excluded)
2025-11-21 11:50:20,565 [INFO] [phase4_8.steering_effect_analyzer] evaluate_steering_effects:608 - Saved 2 corruption steering results to all_corruption_results.json
2025-11-21 11:50:20,565 [INFO] [phase4_8.steering_effect_analyzer] evaluate_steering_effects:616 - Running preservation experiment (correct steering on correct data)...
2025-11-21 11:50:20,565 [INFO] [phase4_8.steering_effect_analyzer] _apply_steering:347 - Applying preservation steering with coefficient 29 to 2 problems
2025-11-21 11:50:20,565 [INFO] [common_simplified.activation_hooks] __init__:185 - Initialized AttentionExtractor for layers [16] at position -1
2025-11-21 11:50:20,565 [INFO] [phase4_8.steering_effect_analyzer] _apply_steering:370 - Created AttentionExtractor for preservation steering on layer 16
2025-11-21 11:50:20,566 [INFO] [common_simplified.activation_hooks] setup_hooks:204 - Set up attention hooks for 1 layers
2025-11-21 11:50:25,564 [INFO] [common_simplified.activation_hooks] setup_hooks:204 - Set up attention hooks for 1 layers
2025-11-21 11:50:27,692 [INFO] [phase4_8.steering_effect_analyzer] _apply_steering:526 - Completed preservation steering: 0 flipped out of 2 successful (2 attempted, 0 excluded)
2025-11-21 11:50:27,697 [INFO] [phase4_8.steering_effect_analyzer] evaluate_steering_effects:633 - Saved 2 preservation steering results to all_preservation_results.json
2025-11-21 11:50:27,697 [INFO] [phase4_8.steering_effect_analyzer] evaluate_steering_effects:676 - Exclusion summary: 0/13 tasks excluded (0.0%)
2025-11-21 11:50:27,697 [INFO] [phase4_8.steering_effect_analyzer] evaluate_steering_effects:680 - Saving parquet files with steering results...
2025-11-21 11:50:27,701 [INFO] [phase4_8.steering_effect_analyzer] evaluate_steering_effects:686 - Saved 9 initially incorrect problems to data/phase4_8_humaneval/selected_incorrect_problems.parquet
2025-11-21 11:50:27,704 [INFO] [phase4_8.steering_effect_analyzer] evaluate_steering_effects:694 - Saved 2 initially correct problems to data/phase4_8_humaneval/selected_correct_problems.parquet
2025-11-21 11:50:27,706 [INFO] [phase4_8.steering_effect_analyzer] evaluate_steering_effects:702 - Saved 2 preservation results to data/phase4_8_humaneval/preservation_problems.parquet
2025-11-21 11:50:27,710 [INFO] [phase4_8.steering_effect_analyzer] run_statistical_tests:713 - Running statistical tests...
2025-11-21 11:50:27,729 [INFO] [phase4_8.steering_effect_analyzer] run_statistical_tests:781 - Correction effect: 1/9 = 11.1%, p=0.0000 (significant)
2025-11-21 11:50:27,730 [INFO] [phase4_8.steering_effect_analyzer] run_statistical_tests:782 - Corruption effect: 2/2 = 100.0%, p=0.0000 (significant)
2025-11-21 11:50:27,730 [INFO] [phase4_8.steering_effect_analyzer] run_statistical_tests:783 - Preservation effect: 2/2 = 100.0%, p=0.2500 (not significant)
2025-11-21 11:50:28,660 [INFO] [phase4_8.steering_effect_analyzer] create_visualizations:870 - Saved visualization to data/phase4_8_humaneval/steering_effect_analysis.png
2025-11-21 11:50:28,663 [INFO] [phase4_8.steering_effect_analyzer] save_examples:928 - Saved 1 corrected examples
2025-11-21 11:50:28,664 [INFO] [phase4_8.steering_effect_analyzer] save_examples:933 - Saved 2 corrupted examples
2025-11-21 11:50:28,664 [INFO] [phase4_8.steering_effect_analyzer] save_examples:938 - Saved 2 preserved examples
2025-11-21 11:50:28,665 [INFO] [phase4_8.steering_effect_analyzer] save_results:994 - Saved results to data/phase4_8_humaneval
2025-11-21 11:50:28,665 [INFO] [phase4_8.steering_effect_analyzer] run:1058 - 
============================================================
2025-11-21 11:50:28,665 [INFO] [phase4_8.steering_effect_analyzer] run:1059 - PHASE 4.8 RESULTS SUMMARY
2025-11-21 11:50:28,665 [INFO] [phase4_8.steering_effect_analyzer] run:1060 - ============================================================
2025-11-21 11:50:28,665 [INFO] [phase4_8.steering_effect_analyzer] run:1061 - Tasks processed: 13/13 (0.0% excluded)
2025-11-21 11:50:28,665 [INFO] [phase4_8.steering_effect_analyzer] run:1063 - Correction experiment: 9/9 (0 excluded)
2025-11-21 11:50:28,665 [INFO] [phase4_8.steering_effect_analyzer] run:1065 - Corruption experiment: 2/2 (0 excluded)
2025-11-21 11:50:28,665 [INFO] [phase4_8.steering_effect_analyzer] run:1067 - Preservation experiment: 2/2 (0 excluded)
2025-11-21 11:50:28,665 [INFO] [phase4_8.steering_effect_analyzer] run:1069 - Correction Rate: 11.1% ✓
2025-11-21 11:50:28,665 [INFO] [phase4_8.steering_effect_analyzer] run:1070 - Corruption Rate: 100.0% ✓
2025-11-21 11:50:28,665 [INFO] [phase4_8.steering_effect_analyzer] run:1071 - Preservation Rate: 100.0% ✓
2025-11-21 11:50:28,665 [INFO] [phase4_8.steering_effect_analyzer] run:1072 - Correction p-value: 0.0000 ✓ significant
2025-11-21 11:50:28,665 [INFO] [phase4_8.steering_effect_analyzer] run:1074 - Corruption p-value: 0.0000 ✓ significant
2025-11-21 11:50:28,665 [INFO] [phase4_8.steering_effect_analyzer] run:1076 - Preservation p-value: 0.2500 ✗ not significant
2025-11-21 11:50:28,666 [INFO] [phase4_8.steering_effect_analyzer] run:1088 - 
All success criteria met: ✗ NO
2025-11-21 11:50:28,666 [INFO] [phase4_8.steering_effect_analyzer] run:1089 - ============================================================

2025-11-21 11:50:28,666 [INFO] [phase4_8.steering_effect_analyzer] run:1091 - Phase 4.8 completed in 278.7 seconds
2025-11-21 11:50:28,666 [INFO] [main] run_phase4_8:965 - 
✅ Phase 4.8 completed successfully
