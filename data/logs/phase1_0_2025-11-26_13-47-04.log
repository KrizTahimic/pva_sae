2025-11-26 13:47:04,547 [INFO] [main] setup_logging:167 - Phase: 1.0, GPU: CPU
2025-11-26 13:47:04,547 [INFO] [main] main:1752 - Detected device: cuda
2025-11-26 13:47:04,857 [INFO] [common.retry_utils] setup_logging:167 - Phase: 1.0, GPU: CPU
2025-11-26 13:47:07,665 [INFO] [common_simplified.model_loader] setup_logging:167 - Phase: 1.0, GPU: CPU
2025-11-26 13:47:07,666 [INFO] [common_simplified.activation_hooks] setup_logging:167 - Phase: 1.0, GPU: CPU
2025-11-26 13:47:07,667 [INFO] [common_simplified.helpers] setup_logging:167 - Phase: 1.0, GPU: CPU
2025-11-26 13:47:07,667 [INFO] [phase1_simplified.runner] setup_logging:167 - Phase: 1.0, GPU: CPU
2025-11-26 13:47:07,667 [INFO] [main] run_phase1:344 - Starting Phase 1: Dataset Building
2025-11-26 13:47:07,667 [INFO] [main] run_phase1:345 - Model: meta-llama/Llama-3.1-8B, Split: sae
2025-11-26 13:47:07,667 [INFO] [main] run_phase1:346 - Processing mode: Sequential (use multi_gpu_launcher.py for parallel processing)
2025-11-26 13:47:07,668 [INFO] [main] run_phase1:349 - 
============================================================
CONFIGURATION
============================================================

ACTIVATION Settings:
  activation_cleanup_after_batch: True
  activation_clear_cache_between_layers: True
  activation_hook_type: resid_post
  activation_layers: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
  activation_max_cache_gb: 10.0
  activation_max_length: 2048
  activation_position: -1

AUTOSAVE Settings:
  autosave_frequency: 100
  autosave_keep_last: 3

CHECKPOINT Settings:
  checkpoint_dir: checkpoints
  checkpoint_frequency: 50

CONTINUE Settings:
  continue_on_error: True

DATASET Settings:
  dataset_dir: data/phase1_0
  dataset_end_idx: None
  dataset_name: mbpp
  dataset_split: test
  dataset_start_idx: 0

ENABLE Settings:
  enable_timing_stats: True

EVALUATION Settings:
  evaluation_random_seed: 42

GC Settings:
  gc_collect_frequency: 50

LOG Settings:
  log_dir: data/logs

MAX Settings:
  max_gpu_memory_usage_gb: 30.0
  max_memory_usage_gb: 100.0
  max_retries: 3

MEMORY Settings:
  memory_cleanup_frequency: 100

MODEL Settings:
  model_device: None
  model_dtype: None
  model_max_new_tokens: 800
  model_name: meta-llama/Llama-3.1-8B
  model_temperature: 0.0
  model_trust_remote_code: True

ORTHOGONALIZATION Settings:
  orthogonalization_target_weights: [embed, attn_o, mlp_down]

PHASE0 Settings:
  phase0_1_output_dir: data/phase0_1
  phase0_2_output_dir: data/phase0_2_humaneval
  phase0_3_output_dir: data/phase0_3_humaneval
  phase0_output_dir: data/phase0

PHASE1 Settings:
  **phase1_output_dir**: data/phase1_0

PHASE2 Settings:
  phase2_10_output_dir: data/phase2_10
  phase2_15_output_dir: data/phase2_15
  phase2_2_output_dir: data/phase2_2
  phase2_5_output_dir: data/phase2_5
  phase2_output_dir: data/phase2

PHASE3 Settings:
  phase3_10_output_dir: data/phase3_10
  phase3_10_temperatures: [0.0, 0.2, 0.4, 0.6, 0.8, 1.0, 1.2, 1.4]
  phase3_11_output_dir: data/phase3_11
  phase3_12_output_dir: data/phase3_12
  phase3_5_output_dir: data/phase3_5
  phase3_6_output_dir: data/phase3_6
  phase3_8_output_dir: data/phase3_8
  phase3_output_dir: data/phase3

PHASE4 Settings:
  phase4_10_min_activation_freq: 0.001
  phase4_10_n_features: 10
  phase4_10_output_dir: data/phase4_10
  phase4_10_separation_threshold: 0.01
  phase4_12_output_dir: data/phase4_12
  phase4_14_output_dir: data/phase4_14
  phase4_14_significance_level: 0.05
  phase4_5_correct_coefficients: [10.0, 20.0, 30.0, 40.0, 50.0, 60.0, 70.0, 80.0, 90.0, 100.0]
  phase4_5_experiment_mode: all
  phase4_5_incorrect_coefficients: [100.0, 200.0, 300.0, 400.0, 500.0, 600.0, 700.0, 800.0, 900.0, 1000.0]
  phase4_5_meaningful_effect_threshold: 5.0
  phase4_5_output_dir: data/phase4_5
  phase4_5_plateau_threshold: 2.0
  phase4_5_search_tolerance: 2.0
  phase4_6_experiment_mode: all
  phase4_6_output_dir: data/phase4_6
  phase4_6_tolerance: 1.0
  phase4_8_correct_coefficient: 29
  phase4_8_experiment_mode: all
  phase4_8_incorrect_coefficient: 287
  phase4_8_output_dir: data/phase4_8

PHASE5 Settings:
  phase5_3_output_dir: data/phase5_3
  phase5_6_output_dir: data/phase5_6
  phase5_9_output_dir: data/phase5_9
  phase5_9_significance_level: 0.05

PHASE6 Settings:
  phase6_3_output_dir: data/phase6_3

PHASE7 Settings:
  phase7_12_output_dir: data/phase7_12
  phase7_3_model_name: google/gemma-2-2b-it
  phase7_3_output_dir: data/phase7_3
  phase7_6_model_name: google/gemma-2-2b-it
  phase7_6_output_dir: data/phase7_6
  phase7_9_output_dir: data/phase7_9

PHASE8 Settings:
  phase8_1_output_dir: data/phase8_1
  phase8_2_output_dir: data/phase8_2
  phase8_3_output_dir: data/phase8_3
  phase8_3_percentile: 70.0
  phase8_3_use_percentile_threshold: True

PILE Settings:
  pile_filter_enabled: True
  pile_samples: 10000
  pile_threshold: 0.02

PROGRESS Settings:
  progress_log_frequency: 10

RETRY Settings:
  retry_backoff: 1.0

SAE Settings:
  sae_checkpoint_dir: data/phase2/sae_checkpoints
  sae_cleanup_after_layer: True
  sae_hook_component: resid_post
  sae_latent_threshold: 0.02
  sae_repo_id: google/gemma-scope-2b-pt-res
  sae_save_after_each_layer: True
  sae_sparsity: 71
  sae_use_memory_mapping: False
  sae_width: 16k

SHOW Settings:
  show_progress_bar: True

SPLIT Settings:
  split_n_strata: 10
  split_random_seed: 42
  split_ratio_tolerance: 0.02

T Settings:
  t_statistic_min_samples: 10

TEMPERATURE Settings:
  temperature_samples_per_temp: 3
  temperature_variation_temps: [0.2, 0.4, 0.6, 0.8, 1.0, 1.2, 1.4]

TIMEOUT Settings:
  timeout_per_record: 300.0

VERBOSE Settings:
  verbose: False

============================================================
2025-11-26 13:47:07,668 [INFO] [main] run_phase1:359 - Found SAE split: data/phase0_1/sae_mbpp.parquet
2025-11-26 13:47:07,668 [INFO] [main] run_phase1:363 - Setting up CUDA environment and cleaning GPU memory...
2025-11-26 13:47:07,668 [INFO] [gpu_utils] setup_logging:167 - Phase: 1.0, GPU: CPU
2025-11-26 13:47:07,669 [INFO] [gpu_utils] setup_cuda_environment:110 - CUDA environment configured for stability
2025-11-26 13:47:07,958 [INFO] [gpu_utils] cleanup_gpu_memory:37 - GPU 0 memory cleaned
2025-11-26 13:47:07,958 [INFO] [phase1_simplified.runner] run:302 - Starting Phase 1 for sae split
2025-11-26 13:47:07,958 [INFO] [phase1_simplified.runner] setup:48 - Auto-detected device: cuda
2025-11-26 13:47:07,958 [INFO] [common_simplified.model_loader] load_model_and_tokenizer:47 - Loading model meta-llama/Llama-3.1-8B on cuda with dtype torch.bfloat16
2025-11-26 13:47:08,906 [INFO] [common_simplified.model_loader] load_model_and_tokenizer:56 - Loading model to cuda...
2025-11-26 13:47:14,400 [INFO] [common_simplified.model_loader] load_model_and_tokenizer:86 - Model successfully loaded on cuda:0
2025-11-26 13:47:14,400 [INFO] [common_simplified.model_loader] load_model_and_tokenizer:88 - Model loaded successfully: LlamaForCausalLM
2025-11-26 13:47:14,401 [INFO] [common_simplified.model_loader] load_model_and_tokenizer:89 - Model size: 8.03B parameters
2025-11-26 13:47:14,401 [INFO] [phase1_simplified.runner] setup:67 - Model loaded: meta-llama/Llama-3.1-8B
2025-11-26 13:47:14,401 [INFO] [phase1_simplified.runner] setup:68 - Extracting residual stream from layers: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
2025-11-26 13:47:14,423 [INFO] [common_simplified.helpers] load_mbpp_from_phase0_1:81 - Loaded 489 problems from sae split
2025-11-26 13:47:14,423 [INFO] [phase1_simplified.runner] run:320 - Processing tasks 0 to 488 (489 out of 489 tasks in sae split)
2025-11-26 13:47:14,423 [INFO] [phase1_simplified.runner] run:333 - Output directory: data/phase1_0_llama (model: meta-llama/Llama-3.1-8B)
2025-11-26 13:47:14,425 [INFO] [phase1_simplified.runner] run:368 - Starting task 1/489: 2
2025-11-26 13:47:14,425 [INFO] [common_simplified.activation_hooks] setup_hooks:53 - Set up hooks for 31 layers to capture residual stream
2025-11-26 13:47:16,554 [INFO] [phase1_simplified.runner] process_task:203 - Task 2: PASS (2.13s)
2025-11-26 13:47:16,635 [INFO] [phase1_simplified.runner] run:368 - Starting task 2/489: 3
2025-11-26 13:47:16,636 [INFO] [common_simplified.activation_hooks] setup_hooks:53 - Set up hooks for 31 layers to capture residual stream
2025-11-26 13:47:19,737 [INFO] [phase1_simplified.runner] process_task:203 - Task 3: PASS (3.10s)
2025-11-26 13:47:19,817 [INFO] [phase1_simplified.runner] run:368 - Starting task 3/489: 4
2025-11-26 13:47:19,817 [INFO] [common_simplified.activation_hooks] setup_hooks:53 - Set up hooks for 31 layers to capture residual stream
2025-11-26 13:47:24,613 [INFO] [phase1_simplified.runner] process_task:203 - Task 4: FAIL (4.79s)
2025-11-26 13:47:24,693 [INFO] [phase1_simplified.runner] run:368 - Starting task 4/489: 6
2025-11-26 13:47:24,693 [INFO] [common_simplified.activation_hooks] setup_hooks:53 - Set up hooks for 31 layers to capture residual stream
2025-11-26 13:47:36,407 [INFO] [phase1_simplified.runner] process_task:203 - Task 6: FAIL (11.71s)
2025-11-26 13:47:36,488 [INFO] [phase1_simplified.runner] run:368 - Starting task 5/489: 7
2025-11-26 13:47:36,488 [INFO] [common_simplified.activation_hooks] setup_hooks:53 - Set up hooks for 31 layers to capture residual stream
2025-11-26 13:47:38,200 [INFO] [phase1_simplified.runner] process_task:203 - Task 7: PASS (1.71s)
2025-11-26 13:47:38,281 [INFO] [phase1_simplified.runner] run:368 - Starting task 6/489: 9
2025-11-26 13:47:38,282 [INFO] [common_simplified.activation_hooks] setup_hooks:53 - Set up hooks for 31 layers to capture residual stream
2025-11-26 13:47:41,183 [INFO] [phase1_simplified.runner] process_task:203 - Task 9: FAIL (2.90s)
2025-11-26 13:47:41,264 [INFO] [phase1_simplified.runner] run:368 - Starting task 7/489: 11
2025-11-26 13:47:41,264 [INFO] [common_simplified.activation_hooks] setup_hooks:53 - Set up hooks for 31 layers to capture residual stream
2025-11-26 13:47:44,038 [INFO] [phase1_simplified.runner] process_task:203 - Task 11: PASS (2.77s)
2025-11-26 13:47:44,118 [INFO] [phase1_simplified.runner] run:368 - Starting task 8/489: 12
2025-11-26 13:47:44,119 [INFO] [common_simplified.activation_hooks] setup_hooks:53 - Set up hooks for 31 layers to capture residual stream
2025-11-26 13:47:50,537 [INFO] [phase1_simplified.runner] process_task:203 - Task 12: PASS (6.42s)
2025-11-26 13:47:50,617 [INFO] [phase1_simplified.runner] run:368 - Starting task 9/489: 13
2025-11-26 13:47:50,618 [INFO] [common_simplified.activation_hooks] setup_hooks:53 - Set up hooks for 31 layers to capture residual stream
2025-11-26 13:47:54,965 [INFO] [phase1_simplified.runner] process_task:203 - Task 13: FAIL (4.35s)
2025-11-26 13:47:55,045 [INFO] [phase1_simplified.runner] run:368 - Starting task 10/489: 15
2025-11-26 13:47:55,046 [INFO] [common_simplified.activation_hooks] setup_hooks:53 - Set up hooks for 31 layers to capture residual stream
2025-11-26 13:47:56,953 [INFO] [phase1_simplified.runner] process_task:203 - Task 15: FAIL (1.91s)
2025-11-26 13:47:57,034 [INFO] [phase1_simplified.runner] run:368 - Starting task 11/489: 16
2025-11-26 13:47:57,034 [INFO] [common_simplified.activation_hooks] setup_hooks:53 - Set up hooks for 31 layers to capture residual stream
2025-11-26 13:47:59,474 [INFO] [phase1_simplified.runner] process_task:203 - Task 16: PASS (2.44s)
2025-11-26 13:47:59,555 [INFO] [phase1_simplified.runner] run:368 - Starting task 12/489: 19
2025-11-26 13:47:59,556 [INFO] [common_simplified.activation_hooks] setup_hooks:53 - Set up hooks for 31 layers to capture residual stream
2025-11-26 13:48:00,732 [INFO] [phase1_simplified.runner] process_task:203 - Task 19: PASS (1.18s)
2025-11-26 13:48:00,813 [INFO] [phase1_simplified.runner] run:368 - Starting task 13/489: 23
2025-11-26 13:48:00,813 [INFO] [common_simplified.activation_hooks] setup_hooks:53 - Set up hooks for 31 layers to capture residual stream
2025-11-26 13:48:05,331 [INFO] [phase1_simplified.runner] process_task:203 - Task 23: FAIL (4.52s)
2025-11-26 13:48:05,412 [INFO] [phase1_simplified.runner] run:368 - Starting task 14/489: 25
2025-11-26 13:48:05,412 [INFO] [common_simplified.activation_hooks] setup_hooks:53 - Set up hooks for 31 layers to capture residual stream
2025-11-26 13:48:08,123 [INFO] [phase1_simplified.runner] process_task:203 - Task 25: PASS (2.71s)
2025-11-26 13:48:08,204 [INFO] [phase1_simplified.runner] run:368 - Starting task 15/489: 26
2025-11-26 13:48:08,204 [INFO] [common_simplified.activation_hooks] setup_hooks:53 - Set up hooks for 31 layers to capture residual stream
2025-11-26 13:48:10,521 [INFO] [phase1_simplified.runner] process_task:203 - Task 26: FAIL (2.32s)
2025-11-26 13:48:10,601 [INFO] [phase1_simplified.runner] run:368 - Starting task 16/489: 30
2025-11-26 13:48:10,602 [INFO] [common_simplified.activation_hooks] setup_hooks:53 - Set up hooks for 31 layers to capture residual stream
2025-11-26 13:48:14,581 [INFO] [phase1_simplified.runner] process_task:203 - Task 30: FAIL (3.98s)
2025-11-26 13:48:14,662 [INFO] [phase1_simplified.runner] run:368 - Starting task 17/489: 31
2025-11-26 13:48:14,662 [INFO] [common_simplified.activation_hooks] setup_hooks:53 - Set up hooks for 31 layers to capture residual stream
2025-11-26 13:48:34,578 [INFO] [phase1_simplified.runner] process_task:203 - Task 31: FAIL (19.91s)
2025-11-26 13:48:34,659 [INFO] [phase1_simplified.runner] run:368 - Starting task 18/489: 32
2025-11-26 13:48:34,660 [INFO] [common_simplified.activation_hooks] setup_hooks:53 - Set up hooks for 31 layers to capture residual stream
2025-11-26 13:48:39,443 [INFO] [phase1_simplified.runner] process_task:203 - Task 32: PASS (4.78s)
2025-11-26 13:48:39,524 [INFO] [phase1_simplified.runner] run:368 - Starting task 19/489: 33
2025-11-26 13:48:39,525 [INFO] [common_simplified.activation_hooks] setup_hooks:53 - Set up hooks for 31 layers to capture residual stream
2025-11-26 13:48:42,569 [INFO] [phase1_simplified.runner] process_task:203 - Task 33: PASS (3.04s)
2025-11-26 13:48:42,650 [INFO] [phase1_simplified.runner] run:368 - Starting task 20/489: 34
2025-11-26 13:48:42,650 [INFO] [common_simplified.activation_hooks] setup_hooks:53 - Set up hooks for 31 layers to capture residual stream
2025-11-26 13:48:44,831 [INFO] [phase1_simplified.runner] process_task:203 - Task 34: PASS (2.18s)
2025-11-26 13:48:44,913 [INFO] [phase1_simplified.runner] run:368 - Starting task 21/489: 35
2025-11-26 13:48:44,914 [INFO] [common_simplified.activation_hooks] setup_hooks:53 - Set up hooks for 31 layers to capture residual stream
2025-11-26 13:48:46,891 [INFO] [phase1_simplified.runner] process_task:203 - Task 35: FAIL (1.98s)
2025-11-26 13:48:46,971 [INFO] [phase1_simplified.runner] run:368 - Starting task 22/489: 36
2025-11-26 13:48:46,972 [INFO] [common_simplified.activation_hooks] setup_hooks:53 - Set up hooks for 31 layers to capture residual stream
2025-11-26 13:48:52,092 [INFO] [phase1_simplified.runner] process_task:203 - Task 36: FAIL (5.12s)
2025-11-26 13:48:52,173 [INFO] [phase1_simplified.runner] run:368 - Starting task 23/489: 38
2025-11-26 13:48:52,173 [INFO] [common_simplified.activation_hooks] setup_hooks:53 - Set up hooks for 31 layers to capture residual stream
2025-11-26 13:48:55,891 [INFO] [phase1_simplified.runner] process_task:203 - Task 38: FAIL (3.72s)
2025-11-26 13:48:55,972 [INFO] [phase1_simplified.runner] run:368 - Starting task 24/489: 39
2025-11-26 13:48:55,973 [INFO] [common_simplified.activation_hooks] setup_hooks:53 - Set up hooks for 31 layers to capture residual stream
2025-11-26 13:49:02,506 [INFO] [phase1_simplified.runner] process_task:203 - Task 39: FAIL (6.53s)
2025-11-26 13:49:02,587 [INFO] [phase1_simplified.runner] run:368 - Starting task 25/489: 41
2025-11-26 13:49:02,588 [INFO] [common_simplified.activation_hooks] setup_hooks:53 - Set up hooks for 31 layers to capture residual stream
2025-11-26 13:49:04,173 [INFO] [phase1_simplified.runner] process_task:203 - Task 41: PASS (1.58s)
2025-11-26 13:49:04,253 [INFO] [phase1_simplified.runner] run:368 - Starting task 26/489: 44
2025-11-26 13:49:04,254 [INFO] [common_simplified.activation_hooks] setup_hooks:53 - Set up hooks for 31 layers to capture residual stream
